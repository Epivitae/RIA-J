name: Sync to GitCode

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 第一步：把 GitHub 的代码拉取到 Action 运行环境
      - name: Checkout GitHub Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 拉取所有分支和历史，确保同步完整

      # 第二步：强制推送到 GitCode
      - name: Push to GitCode
        env:
          GITCODE_USER: "RIA-J" # 确认这是你的 GitCode 用户名
          GITCODE_TOKEN: ${{ secrets.GITCODE_TOKEN }}
        run: |
          # 构造带 Token 的远端地址 (隐藏 Token 输出)
          REMOTE_URL="https://${GITCODE_USER}:${GITCODE_TOKEN}@gitcode.com/${GITCODE_USER}/RIA-J.git"
          
          # 添加 GitCode 远端
          git remote add gitcode "$REMOTE_URL"
          
          # 获取当前分支名称
          CURRENT_BRANCH=$(git branch --show-current)
          
          echo "Starting push to GitCode branch: $CURRENT_BRANCH..."
          
          # 强制推送当前分支到 GitCode
          git push gitcode "$CURRENT_BRANCH" --force